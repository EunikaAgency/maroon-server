let containers = document.querySelectorAll(".dsm-filterable-gallery-container"); function chunk(e, t) { for (var a = [], r = 0, i = e.length; r < i;)a.push(e.slice(r, r += t)); return a } containers.forEach((e, t) => { let a = e.dataset.use_lightbox, r = e.querySelector(".dsm-filterable-gallery-inner-container"); "on" === a && jQuery(document).ready(function (e) { e(r).magnificPopup({ delegate: ".dsm-filterable-gallery-item", type: "image", tLoading: "Loading image ", gallery: { enabled: !0, navigateByImgClick: !0, preload: [0, 1] }, image: { tError: '<a href="%url%">The image </a> could not be loaded.' } }) }) }), containers.forEach(e => { let t = e.querySelector(".dsm-filterable-gallery-inner-container"), a = e.querySelector(".dsm-gallery-loadmore-container"), r = e.querySelector(".dsm-gallery-number-pagination-container"), i = e.querySelectorAll(".dsm-filterable-gallery-filter-item"), n = Number(e.dataset.per_page), l = "on" === e.dataset.showpagination, s = e.dataset.paginationtype, d = Number(e.dataset.speed), c = new window.Shuffle(t, { itemSelector: ".dsm-filterable-gallery-item", delimiter: ",", speed: d }); function o() { let t = Number(e.dataset.totalpages); r.innerHTML = ""; let a = document.createElement("span"); a.classList.add("dsm-gallery-number-pagination"), a.setAttribute("data-pagination", "prev"), a.innerHTML = "Prev", r.appendChild(a), Array(t).fill(0).map((e, t) => { let a = t + 1, i = document.createElement("span"); i.innerHTML = a, i.classList.add("dsm-gallery-number-pagination"), i.setAttribute("data-pagination", a), r.appendChild(i) }); let i = document.createElement("span"); i.classList.add("dsm-gallery-number-pagination"), i.setAttribute("data-pagination", "next"), i.innerHTML = "Next", r.appendChild(i), m() } function g() { let e = Array.from(i).find(e => e.classList.contains("dsm-active-filter")); return e && e.hasAttribute("data-category") && "undefined" !== e.dataset.category ? e.dataset.category : "all" } function u(t) { let a = e.querySelectorAll(".dsm-filterable-gallery-item"), r = Array.from(a).filter(e => e.dataset.groups.split(",").includes(t)), i = l ? n : r.length, s = chunk(r, i); a.forEach(e => { e.setAttribute("data-inpage", "-1") }), s.forEach((e, t) => { let a = t + 1; e.forEach(e => { e.setAttribute("data-inpage", a.toString()) }) }), e.setAttribute("data-totalPages", s.length); let d = e.querySelectorAll(".dsm-filterable-gallery-item"), c = Array.from(d).filter(a => { let r = Number(a.dataset.inpage), i = a.dataset.groups.split(",").includes(t), n = Number(e.dataset.currentpage) + 1; return r === n && i }), o = Array.from(d).filter(a => { let r = Number(a.dataset.inpage), i = a.dataset.groups.split(",").includes(t), n = Number(e.dataset.currentpage) - 1; return r === n && i }), g = c.length > 0, u = o.length > 0; e.setAttribute("data-hasnextpage", String(g)), e.setAttribute("data-hasPrevpage", String(u)) } function p() { let t = Number(e.dataset.currentpage), a = t + 1, r = g(); e.setAttribute("data-currentpage", a.toString()), u(r), b(r, a) } function m() { if (!r) return; let t = r.querySelectorAll(".dsm-gallery-number-pagination"), a = Number(e.dataset.currentpage) > 1, i = "true" === e.dataset.hasnextpage; t.forEach(r => { isNaN(r.dataset.pagination) || i || a || (r.style.display = "none"), Number(e.dataset.currentpage) === Number(r.dataset.pagination) && r.classList.add("dsm-active-pagination-item"), r.addEventListener("click", () => { i = "true" === e.dataset.hasnextpage, t.forEach(e => e.classList.remove("dsm-active-pagination-item")); let n = Number(e.dataset.currentpage), l = r.dataset.pagination, s = g(); switch (a = n > 1, l) { case "next": { if (!i) return; let d = n + 1; t.forEach(e => { let t = e.dataset.pagination; d === Number(t) && e.classList.add("dsm-active-pagination-item") }), e.setAttribute("data-currentpage", d), b(s, d) } break; case "prev": { if (!a) return; let c = n - 1; t.forEach(e => { let t = e.dataset.pagination; c === Number(t) && e.classList.add("dsm-active-pagination-item") }), e.setAttribute("data-currentpage", c), b(s, c) } break; default: r.classList.add("dsm-active-pagination-item"), e.setAttribute("data-currentpage", l), b(s, Number(l)) } }) }) } function f() { e.setAttribute("data-currentpage", "1") } function y(e) { i.forEach(t => { let a = t.dataset.category; e === a ? t.classList.add("dsm-active-filter") : t.classList.remove("dsm-active-filter") }) } function b(t, a = e.dataset.currentpage) { a = Number(e.dataset.currentpage), c.filter(e => { let r = Number(e.dataset.inpage), i = e.dataset.groups, n = ("number" === s ? r === a : r <= a) && -1 !== r, l = i.split(",").includes(t); return l && n }), y(t), u(t) } i.forEach(e => { e.addEventListener("click", () => { let t = e.dataset.category; u(t), f(), b(t), r && o() }) }), a && a.addEventListener("click", () => p()); let h = i[0].dataset.category; u(h), b(h), m() });